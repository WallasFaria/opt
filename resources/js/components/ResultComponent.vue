<template>
    <div>
        <transition name='slide-up'>
            <search-component
                v-if="showSearch"
                :value="query.name"
                :className="'top'" />
        </transition>

        <div class="main">
            <div class="content">
                <div class="result">
                    <card-component v-for="(place, index) in places"
                        :key="index"
                        :place="place" />
                </div>
            </div>
        </div>
    </div>
</template>

<script>
    import SearchComponent from "./SearchComponent.vue";
    import CardComponent from "./CardComponent.vue";

    export default {
        components: {
            'search-component': SearchComponent,
            'card-component': CardComponent,
        },

        async mounted() {
            this.showSearch = true;

            await this.$getLocation({ enableHighAccuracy: true })
                .then(coords => {
                    this.query.lat = coords.lat
                    this.query.lon = coords.lng
                })

            axios.get('/api/places/', { params: this.query })
                .then(result => {
                    this.places = result
                })
        },

        data() {
            return {
                places: [
                    {
                        name: "Banco do Brasil",
                        final_address: "R. Eng. Franco Amaral, 13 - Parque Flamboyant, Campos dos Goytacazes - RJ, 28015-270",
                        open_now: false,
                        contact: "(22) 2724-5111"
                    }
                ],
                sortOption: ['distance', 'popularity'],
                query:  {
                    name: this.$route.query.q,
                    radius: 5000,
                    lat: 0,
                    lon: 0,
                    sortBy: 'popularity'
                },
                showSearch: false
            }
        },

    }
</script>

<style>
    .slide-up-enter-active {
        transition: all .5s;
    }
    .slide-up-enter {
        transform: translateY(200px);
    }
</style>
